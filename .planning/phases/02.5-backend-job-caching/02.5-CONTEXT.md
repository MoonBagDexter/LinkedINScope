# Phase 2.5: Backend Job Caching - Context

**Gathered:** 2026-02-02
**Status:** Ready for planning

<domain>
## Phase Boundary

Move job fetching from client-side (per-user JSearch API calls) to backend caching architecture. Backend service fetches service-industry jobs periodically from JSearch API and stores in Supabase. Frontend queries cached data directly, eliminating slow API calls and reducing quota usage by 90%+.

**Performance goal:** <2 second page loads (vs current slow loads)
**Scope:** Backend service, data migration, frontend query refactor. Does not include new job categories or search features.

</domain>

<decisions>
## Implementation Decisions

### Service Architecture
- **Deployment approach:** Claude's discretion - pick simplest solution (Supabase Edge Function, Node.js service, etc.) that stays within free tiers
- **Budget constraint:** CRITICAL - Stay within free tiers (Supabase, JSearch). Only pay for Vercel if absolutely necessary. This is a prototype that needs to work but may only last 1-2 days. No upfront payments required.
- **Job categories:** Service-industry only (hardcoded) - matches current frontend behavior
- **API key storage:** Claude's discretion - secure appropriately for chosen deployment
- **Manual trigger:** Yes - provide endpoint/mechanism to manually trigger job refresh for testing and debugging

### Update Strategy
- **Refresh frequency:** Claude's discretion - balance freshness with free tier quota (500 requests/month). Consider project may only run 1-2 days.
- **Failure handling:** Retry a few times, keep old cached jobs if all retries fail (graceful degradation)
- **Success logging:** Yes - log timestamp and count on successful refresh (e.g., "Refreshed 150 jobs at 2026-02-02 10:00 UTC")
- **Initial fetch:** Fetch immediately when service starts (don't wait for first scheduled interval)

### Data Handling
- **Schema:** Claude's discretion - new table vs expanded existing 'jobs' table. Choose based on clean separation of concerns.
- **Stale jobs:** Keep in database, mark as inactive - preserves click history and lane data for jobs no longer in JSearch
- **Data merge:** Preserve existing lane and click_count - new jobs get lane='new'/click_count=0, existing jobs keep engagement state
- **Last updated tracking:** Claude's discretion - add if useful for transparency/debugging, skip if adds unnecessary complexity

### Transition Approach
- **Rollout strategy:** Claude's discretion - hard cutover vs feature flag with fallback. Minimize risk for V1.
- **Legacy code:** Claude's discretion - delete or preserve JSearch frontend code (jsearch.ts, useJobs hook)
- **Loading UI:** Claude's discretion - keep existing skeleton or optimize for instant cached loads
- **User visibility:** No indication to users that jobs are cached - performance improvement is invisible

### Claude's Discretion
- Specific deployment platform (Supabase Edge Function, Node.js service, etc.)
- Exact refresh interval (daily, 6-hour, etc.) based on quota and freshness needs
- Database schema design (separate jobs_data table vs expanded jobs table)
- Rollout strategy (hard cutover vs gradual)
- Whether to preserve or delete frontend JSearch code
- Loading UI optimization
- Admin UI for manual refresh

</decisions>

<specifics>
## Specific Ideas

**Key constraint from user:**
"This project is probably gonna last a day or two max. I'm only gonna pay for anything if it succeeds. I'm not required to pay up upfront."

- Optimize for quick prototype that can scale if successful
- Free tier only (Supabase, JSearch API)
- Vercel acceptable if needed, but prefer free alternatives
- Must work well and look good, but don't over-engineer for scale

**Performance target:**
- <2 second initial page load (current is "slow" per user feedback)
- 90%+ reduction in API quota usage

**Invisibility requirement:**
- Users should not see any indication that jobs are cached
- This is a behind-the-scenes performance improvement

</specifics>

<deferred>
## Deferred Ideas

None - discussion stayed within phase scope

</deferred>

---

*Phase: 02.5-backend-job-caching*
*Context gathered: 2026-02-02*
